<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>ონლაინ მაღაზია</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css" />
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </head>
  <body>
  <div class="container" id="container">
	<h1 class="mt-3 mb-5">ონლაინ მაღაზია</h1>
	<div id="products" class="table-responsive">
		<table class="table table-hover">
		  <thead>
			<tr>
			  <th scope="col">#</th>
			  <th scope="col">დასახელება</th>
			  <th scope="col">ფასი</th>
			  <th scope="col">მოქმედება</th>
			</tr>
		  </thead>
		  <tbody id="productstlist">
		  </tbody>
		</table>
	</div>
	<h3 class="mt-5 mb-3">კალათა</h3>
	<div id="cart">
		<table class="table table-hover">
		  <thead>
			<tr>
			  <th scope="col">#</th>
			  <th scope="col">დასახელება</th>
			  <th scope="col">ფასი</th>
			  <th scope="col">რაოდენობა</th>
			  <th scope="col">ჯამი</th>
			  <th scope="col">მოქმედება</th>
			</tr>
		  </thead>
		  <tbody id="cartlist">
		  </tbody>
		</table>
	</div>
	<h3 class="mt-5 mb-3">დაანგარიშებული თანხა</h3>
	<div id="totalPrice">
	
	</div>
  </div>
  <script>
  // პროდუქტების მასივი
  var products = [
	["კომპიუტერი", 1900],
	["ლეპტოპი", 2500],
	["პლანშეტი", 150],
	["მობილური ტელეფონი", 900],
	["კომპიუტერული ნაწილები", 100]
  ];
  
  var total = 0;

  // პროდუქტების მშობელი ობიექტი
  var productsObj = document.getElementById("productstlist");

  // ყველა პროდუქტის ობიექტის ჩამატება მშობელ ობიექტში
  for (var i = 0; i < products.length; i++) {
	var productId = i;
	var product = products[productId];
	var productName = product[0];
	var productPrice = product[1];

	var productObj = '';
	productObj += '<tr id="product-' + productId + '">';
	productObj += '    <td><span id="id-' + productId + '">' + (productId + 1) + '</span></td>';
	productObj += '    <td><span id="name-' + productId + '">' + productName + '</span></td>';
	productObj += '    <td><span id="price-' + productId + '">' + productPrice + '</span></td>';
	productObj += '    <td><button class="btn btn-primary" id="id-' + productId + '" onclick="addcart(' + productId + ')">კალათაში დამატება</button></td>';
	productObj += '</tr>';

	productsObj.innerHTML += productObj;
  }

  // კალათაში დამატების ფუნქცია
  function addcart(productID) {
	var productName = document.getElementById("name-" + productID).innerHTML;
	var productPrice = document.getElementById("price-" + productID).innerHTML;
	var cartObj = document.getElementById("cartlist");

	if (!document.getElementById("cart-product-" + productID)) {
		var productObj = '';
		productObj += '<tr id="cart-product-' + productID + '">';
		productObj += '    <td><span id="cart-ID-' + productID + '">' + (productID + 1) + '</span></td>';
		productObj += '    <td><span id="cart-name-' + productID + '">' + productName + '</span></td>';
		productObj += '    <td><span id="cart-price-' + productID + '">' + productPrice + '</span></td>';
		productObj += '    <td><input class="form-control" type="number" id="cart-quantity-' + productID + '" value="1" min="1" onchange="cartCalculate(this, ' + productID + ')" onfocus="this.oldvalue = +this.value;"></td>';
		productObj += '    <td><span id="cart-total-' + productID + '">' + productPrice + '</span></td>';
		productObj += '    <td><button class="btn btn-danger" id="cart-id-' + productID + '" title="კალათიდან ამოშლა" onclick="removecart(' + productID + ')"><i class="fas fa-times"></i></button></td>';
		productObj += '</tr>';
		
		cartObj.innerHTML += productObj;
		
		document.getElementById("cart-quantity-" + productID).oldvalue = +document.getElementById("cart-quantity-" + productID).value;

		total = total + +productPrice;
		updateTotal();
	}
  }

  // კალათიდან ამოშლის ფუნქცია
  function removecart(productID) {
	if (confirm('ნამდვილად გსურთ კალათიდან წაშლა ?')) {
		var productTotal = document.getElementById('cart-total-' + productID).innerHTML;
		total = total - +productTotal;
		updateTotal();

		document.getElementById('cart-product-' + productID).outerHTML = '';
	}
  }

  // კალათაში დაანგარიშების ფუნქცია
  function cartCalculate(input, productID) {
	var productPrice = document.getElementById('cart-price-' + productID).innerHTML;
	var productQuantity = document.getElementById('cart-quantity-' + productID).value;
	var productTotal = productPrice * productQuantity;

	document.getElementById('cart-total-' + productID).innerHTML = productTotal;

	var oldPrice = +input.oldvalue * +productPrice;
	console.log('old price: ' + oldPrice);
	console.log('old price val: ');
	console.log(input.oldvalue);

	var newPrice = +input.value * +productPrice;
	console.log('new price: ' + newPrice);
	console.log('new price val: ');
	console.log(input.value);

	total = total - oldPrice + newPrice;
	updateTotal();

	input.oldvalue = +input.value;
  }

  function updateTotal() {
	document.getElementById('totalPrice').innerHTML = total;
  }
  </script>
  </body>
</html>
